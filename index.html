<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CosmoChem Quest — Science Quiz (Planets + Elements)</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: #121935;
      --accent: #6ee7ff;
      --accent-2: #a78bfa;
      --text: #e6ecff;
      --muted: #9fb0d6;
      --good: #22c55e;
      --bad: #ef4444;
      --warn: #f59e0b;
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0; background: radial-gradient(1200px 600px at 10% -10%, #1a245a22, transparent),
                  radial-gradient(800px 400px at 90% 10%, #3f1a6a22, transparent), var(--bg);
      color: var(--text); font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    a { color: var(--accent) }
    .container { max-width: 960px; margin: 0 auto; padding: 20px }
    header {
      display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; margin: 12px 0 8px;
    }
    .title { display: flex; align-items: center; gap: 10px; font-weight: 800; letter-spacing: .3px }
    .title .logo { width: 40px; height: 40px; border-radius: 12px; background: linear-gradient(135deg, var(--accent), var(--accent-2)); display: grid; place-items: center; color: #00111a; font-weight: 900 }

    .hud { display: flex; gap: 10px; align-items: center; flex-wrap: wrap }
    .pill { background: #ffffff14; border: 1px solid #ffffff1f; padding: 6px 10px; border-radius: 999px; color: var(--muted); display: inline-flex; align-items: center; gap: 8px }
    .pill strong { color: var(--text) }
    .hearts { letter-spacing: 2px }

    .card { background: linear-gradient(180deg, #12193a, #0d1330); border: 1px solid #ffffff14; border-radius: 18px; box-shadow: 0 10px 30px #0008; padding: 20px }
    .card + .card { margin-top: 14px }

    .grid { display: grid; gap: 12px }
    .grid.answers { grid-template-columns: repeat(1, 1fr) }
    @media (min-width: 640px) { .grid.answers { grid-template-columns: repeat(2, 1fr) } }

    button, select, input[type="text"], input[type="number"] {
      background: #0f1531; border: 1px solid #2a3563; color: var(--text); border-radius: 12px; padding: 12px 14px; font-size: 16px; outline: none; transition: transform .02s ease, background .2s, border .2s, opacity .2s; width: 100%;
    }
    button { cursor: pointer; background: linear-gradient(180deg, #1a2250, #0e1435); border: 1px solid #33407a }
    button:hover { transform: translateY(-1px) }
    button:active { transform: translateY(1px) }
    .btn-primary { background: linear-gradient(180deg, var(--accent), #33bde0); color: #001018; border: none; font-weight: 800 }
    .btn-ghost { background: #ffffff10; border: 1px dashed #ffffff2a }
    .btn-good { background: linear-gradient(180deg, #2dd773, #16a34a); border: none; color: #00140a; font-weight: 800 }
    .btn-bad { background: linear-gradient(180deg, #ff6767, #ef4444); border: none; color: #330000; font-weight: 800 }

    .qtext { font-size: clamp(20px, 2.4vw + 12px, 28px); font-weight: 800 }
    .meta { color: var(--muted); font-size: 14px }
    .muted { color: var(--muted) }
    .center { text-align: center }
    .right { text-align: right }

    .progress { height: 10px; background: #ffffff10; border: 1px solid #ffffff1f; border-radius: 999px; overflow: hidden }
    .progress > i { display: block; height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--accent-2)) }

    .tag { background: #00000033; border: 1px solid #ffffff22; padding: 6px 10px; border-radius: 999px; font-size: 13px; color: var(--muted); display: inline-flex; align-items: center; gap: 8px }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: #00000055; padding: 2px 6px; border-radius: 6px; border: 1px solid #ffffff22 }

    .hidden { display: none !important }

    .toast { position: fixed; left: 50%; transform: translateX(-50%); bottom: 24px; background: #000000b0; padding: 10px 14px; border-radius: 12px; border: 1px solid #ffffff2a; font-size: 14px }

    .review-list { display: grid; gap: 10px }
    .review-item { background: #0d1430; border: 1px solid #ffffff14; border-radius: 12px; padding: 10px }

    /* Confetti */
    .confetti { position: fixed; inset: 0; pointer-events: none; overflow: hidden }
    .piece { position: absolute; width: 8px; height: 12px; opacity: .9 }

    footer { color: var(--muted); font-size: 13px; margin: 16px 0 32px }
  </style>
</head>
<body>
  <!--
    CosmoChem Quest — Fun science quiz about PLANETS + ELEMENTS

    👉 Quick customization (search these in this file):
       const GAME_TITLE = "CosmoChem Quest";
       const CTA_URL = "https://amzn.to/46igITu"; // your link
       const CTA_TEXT = "Extend the science fun — get a beginner-friendly telescope now!"; // button text

    How to use:
      1) Save this file as index.html and double‑click to play.
      2) To sell/deliver, zip it as CosmoChem-Quest.zip.
      3) To personalize (kid’s name, school logo), update GAME_TITLE and optionally the header HTML.
  -->

  <div class="container">
    <header>
      <div class="title"><div class="logo">🧪</div> <span id="gameTitle">CosmoChem Quest</span></div>
      <div class="hud">
        <div class="pill"><span>Score</span> <strong id="score">0</strong></div>
        <div class="pill"><span>Streak</span> <strong id="streak">0</strong></div>
        <div class="pill"><span>Time</span> <strong id="time">—</strong></div>
        <div class="pill hearts" title="Lives">❤️❤️❤️</div>
        <a id="ctaTop" class="pill" href="#" target="_blank" rel="noopener">🔗 <strong>Get more science games</strong></a>
      </div>
    </header>

    <!-- START SCREEN -->
    <section id="screenStart" class="card">
      <h2 class="center" style="margin-top:4px">Ready to play?</h2>
      <p class="center muted" style="margin:-4px 0 14px">Choose a mode and difficulty, then press Start. Answer fast for more points. Use <span class="kbd">50/50</span> once per game!</p>
      <div class="grid" style="grid-template-columns: repeat(1, 1fr); gap: 14px; max-width: 680px; margin: 0 auto">
        <div class="card">
          <div class="grid" style="grid-template-columns: repeat(2, 1fr); gap: 12px">
            <label>Category
              <select id="category">
                <option value="mixed">🌌 Mixed (Planets + Elements)</option>
                <option value="planets">🪐 Planets</option>
                <option value="elements">🔬 Elements</option>
              </select>
            </label>
            <label>Difficulty
              <select id="difficulty">
                <option value="easy">Easy</option>
                <option value="medium" selected>Medium</option>
                <option value="hard">Hard</option>
              </select>
            </label>
          </div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px">
            <button id="btnStart" class="btn-primary">▶ Start Game</button>
            <button id="btnHow" class="btn-ghost">❓ How to Play</button>
          </div>
        </div>
        <div class="card">
          <div class="grid" style="grid-template-columns: 1fr 1fr 1fr; gap: 10px">
            <div class="tag">⏱️ <b>Timed</b> questions</div>
            <div class="tag">🔥 Bonus for streaks</div>
            <div class="tag">💡 One 50/50 hint</div>
          </div>
          <p class="muted" style="margin-top:8px">Tip: Personalize this for a child, classroom, or brand to charge more.</p>
        </div>
      </div>
    </section>

    <!-- GAME SCREEN -->
    <section id="screenGame" class="card hidden">
      <div class="grid" style="gap: 6px">
        <div class="meta">
          <span id="metaQ"></span>
          <span class="right" style="float:right"><button id="btnFifty" class="btn-ghost" style="padding:6px 10px; width:auto">💡 50/50</button></span>
        </div>
        <div class="qtext" id="qtext">Question text…</div>
        <div id="explain" class="muted" style="min-height:22px"></div>
        <div class="grid answers" id="answers"></div>
        <div class="progress"><i id="timebar"></i></div>
      </div>
    </section>

    <!-- END SCREEN -->
    <section id="screenEnd" class="card hidden">
      <h2 class="center" style="margin-top:4px">Great run! 🎉</h2>
      <p class="center muted" id="summary"></p>
      <div class="grid" style="grid-template-columns: 1fr; gap: 10px; max-width: 680px; margin: 0 auto">
        <button id="btnPlayAgain" class="btn-primary">🔁 Play Again</button>
        <a id="ctaEnd" class="btn-good center" href="#" target="_blank" rel="noopener">🔗 Get more science games</a>
        <button id="btnCopy" class="btn-ghost">📋 Copy Share Text</button>
      </div>
       <!-- Add this disclosure paragraph -->
  <p class="center muted" style="font-size:12px;margin-top:6px">
    Disclosure: This page may contain affiliate links. I may earn a commission at no extra cost to you.
  </p>
<details style="margin-top:12px">
        <summary class="muted">Review answers</summary>
        <div class="review-list" id="review"></div>
      </details>
    </section>

   <footer class="center">
  Made with 💙 — Enjoy!
  <br><span class="muted" style="font-size:12px">
    Disclosure: This page may contain affiliate links. I may earn a commission at no extra cost to you.
  </span>
</footer>


  <script>
    // ======================
    // Quick Config
    // ======================
    const GAME_TITLE = "CosmoChem Quest";
    const CTA_URL = "https://amzn.to/46igITu"; // ← replace with your link
    const CTA_TEXT = "Extend the science fun — get a beginner-friendly telescope now!"; // CTA label

    // Apply title + URLs
    document.getElementById('gameTitle').textContent = GAME_TITLE;
    const ctaTop = document.getElementById('ctaTop');
    const ctaEnd = document.getElementById('ctaEnd');
    ctaTop.href = CTA_URL; ctaTop.querySelector('strong').textContent = CTA_TEXT;
    ctaEnd.href = CTA_URL; ctaEnd.textContent = '🔗 ' + CTA_TEXT;

    // ======================
    // Data: Planets & Elements
    // (facts chosen to be broadly accepted & classroom-safe)
    // ======================
    const PLANETS = [
      {name:'Mercury', order:1, type:'rocky', hasRings:false, color:'gray', fact:'Smallest planet and closest to the Sun.'},
      {name:'Venus', order:2, type:'rocky', hasRings:false, color:'yellow', fact:'Hottest average surface due to a thick greenhouse atmosphere.'},
      {name:'Earth', order:3, type:'rocky', hasRings:false, color:'blue', fact:'Our home planet; the only one known with life and liquid water oceans.'},
      {name:'Mars', order:4, type:'rocky', hasRings:false, color:'red', hasOlympusMons:true, fact:'Known as the Red Planet; home to Olympus Mons, a giant volcano.'},
      {name:'Jupiter', order:5, type:'gas', hasRings:true, redSpot:true, fact:'Largest planet; famous for the Great Red Spot storm.'},
      {name:'Saturn', order:6, type:'gas', hasRings:true, fact:'Iconic for its bright ring system.'},
      {name:'Uranus', order:7, type:'ice', hasRings:true, tilted:true, fact:'Rotates on its side (extreme axial tilt).'},
      {name:'Neptune', order:8, type:'ice', hasRings:true, fastWinds:true, fact:'Deep blue and known for very fast winds.'}
    ];

    const ELEMENTS = [
      {name:'Hydrogen', symbol:'H', atomicNumber:1, group:'nonmetal', state:'gas'},
      {name:'Helium', symbol:'He', atomicNumber:2, group:'noble gas', state:'gas'},
      {name:'Lithium', symbol:'Li', atomicNumber:3, group:'alkali metal', state:'solid'},
      {name:'Beryllium', symbol:'Be', atomicNumber:4, group:'alkaline earth metal', state:'solid'},
      {name:'Boron', symbol:'B', atomicNumber:5, group:'metalloid', state:'solid'},
      {name:'Carbon', symbol:'C', atomicNumber:6, group:'nonmetal', state:'solid'},
      {name:'Nitrogen', symbol:'N', atomicNumber:7, group:'nonmetal', state:'gas'},
      {name:'Oxygen', symbol:'O', atomicNumber:8, group:'nonmetal', state:'gas'},
      {name:'Fluorine', symbol:'F', atomicNumber:9, group:'halogen', state:'gas'},
      {name:'Neon', symbol:'Ne', atomicNumber:10, group:'noble gas', state:'gas'},
      {name:'Sodium', symbol:'Na', atomicNumber:11, group:'alkali metal', state:'solid'},
      {name:'Magnesium', symbol:'Mg', atomicNumber:12, group:'alkaline earth metal', state:'solid'},
      {name:'Aluminum', symbol:'Al', atomicNumber:13, group:'post-transition metal', state:'solid'},
      {name:'Silicon', symbol:'Si', atomicNumber:14, group:'metalloid', state:'solid'},
      {name:'Phosphorus', symbol:'P', atomicNumber:15, group:'nonmetal', state:'solid'},
      {name:'Sulfur', symbol:'S', atomicNumber:16, group:'nonmetal', state:'solid'},
      {name:'Chlorine', symbol:'Cl', atomicNumber:17, group:'halogen', state:'gas'},
      {name:'Argon', symbol:'Ar', atomicNumber:18, group:'noble gas', state:'gas'},
      {name:'Potassium', symbol:'K', atomicNumber:19, group:'alkali metal', state:'solid'},
      {name:'Calcium', symbol:'Ca', atomicNumber:20, group:'alkaline earth metal', state:'solid'},
      {name:'Iron', symbol:'Fe', atomicNumber:26, group:'transition metal', state:'solid'},
      {name:'Copper', symbol:'Cu', atomicNumber:29, group:'transition metal', state:'solid'},
      {name:'Zinc', symbol:'Zn', atomicNumber:30, group:'transition metal', state:'solid'},
      {name:'Silver', symbol:'Ag', atomicNumber:47, group:'transition metal', state:'solid'},
      {name:'Tin', symbol:'Sn', atomicNumber:50, group:'post-transition metal', state:'solid'},
      {name:'Iodine', symbol:'I', atomicNumber:53, group:'halogen', state:'solid'},
      {name:'Gold', symbol:'Au', atomicNumber:79, group:'transition metal', state:'solid'},
      {name:'Mercury', symbol:'Hg', atomicNumber:80, group:'transition metal', state:'liquid'},
      {name:'Lead', symbol:'Pb', atomicNumber:82, group:'post-transition metal', state:'solid'},
      {name:'Platinum', symbol:'Pt', atomicNumber:78, group:'transition metal', state:'solid'},
      {name:'Uranium', symbol:'U', atomicNumber:92, group:'actinide', state:'solid'}
    ];

    // Utility helpers
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const shuffle = arr => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);
    const pick = (arr, n=1) => shuffle(arr).slice(0,n);

    // Game state
    let state = {
      playing:false,
      category:'mixed',
      difficulty:'medium',
      qIndex:0,
      score:0,
      streak:0,
      lives:3,
      timeLeft:0,
      timerId:null,
      usedFifty:false,
      questions:[],
      history:[] // {q, options, correctIndex, chosenIndex, explain, points}
    };

    // Difficulty settings
    const DIFF = {
      easy:   { perQ: 22, options: 3, streakBonus: 5 },
      medium: { perQ: 17, options: 4, streakBonus: 8 },
      hard:   { perQ: 12, options: 5, streakBonus: 12 }
    };

    // ======================
    // Question Generators
    // ======================
    function genPlanetQuestion() {
      const p = pick(PLANETS, 1)[0];
      const types = ['order','nickname','feature','type','rings'];
      const t = pick(types,1)[0];

      if (t==='order') {
        const correct = `${p.name}`;
        const others = pick(PLANETS.filter(x=>x.order!==p.order), DIFF[state.difficulty].options-1).map(x=>x.name);
        const q = `Which planet is <b>#${p.order}</b> from the Sun?`;
        const explain = `${p.name} is planet #${p.order} from the Sun.`;
        return {q, options: shuffle([correct,...others]), answer: correct, explain};
      }
      if (t==='nickname') {
        const map = {
          'Mars':'the Red Planet',
          'Jupiter':'home to the Great Red Spot',
          'Saturn':'famous for its bright rings',
          'Uranus':'tilted and spins on its side',
          'Venus':'has the hottest average surface',
          'Mercury':'closest to the Sun',
          'Neptune':'deep blue with very fast winds',
          'Earth':'the blue planet with liquid water oceans'
        };
        const statement = map[p.name];
        const q = `Which planet is known as <b>${statement}</b>?`;
        const correct = p.name;
        const others = pick(PLANETS.filter(x=>x.name!==p.name), DIFF[state.difficulty].options-1).map(x=>x.name);
        return {q, options: shuffle([correct,...others]), answer: correct, explain: PLANETS.find(x=>x.name===correct).fact };
      }
      if (t==='feature') {
        const features = [];
        if (p.redSpot) features.push({prompt:'has the Great Red Spot', check: x=>x.redSpot});
        if (p.hasOlympusMons) features.push({prompt:'has Olympus Mons (giant volcano)', check: x=>x.hasOlympusMons});
        if (p.tilted) features.push({prompt:'rotates on its side', check: x=>x.tilted});
        if (p.fastWinds) features.push({prompt:'is known for very fast winds', check: x=>x.fastWinds});
        if (!features.length) return genPlanetQuestion();
        const f = pick(features,1)[0];
        const q = `Which planet ${f.prompt}?`;
        const correct = p.name;
        const others = pick(PLANETS.filter(x=>!f.check(x)), DIFF[state.difficulty].options-1).map(x=>x.name);
        return {q, options: shuffle([correct,...others]), answer: correct, explain: PLANETS.find(x=>x.name===correct).fact };
      }
      if (t==='type') {
        const labels = {rocky:'a rocky (terrestrial) planet', gas:'a gas giant', ice:'an ice giant'};
        const q = `What kind of planet is <b>${p.name}</b>?`;
        const correct = labels[p.type];
        const otherTypes = shuffle(['a rocky (terrestrial) planet','a gas giant','an ice giant'].filter(x=>x!==correct)).slice(0, DIFF[state.difficulty].options-1);
        return {q, options: shuffle([correct, ...otherTypes]), answer: correct, explain: `${p.name} is ${labels[p.type]}.` };
      }
      if (t==='rings') {
        const q = `Does <b>${p.name}</b> have rings?`;
        const correct = p.hasRings ? 'Yes' : 'No';
        const options = DIFF[state.difficulty].options >= 4 ? ['Yes','No','Only faint rings','Only sometimes'] : ['Yes','No','Not sure'];
        return {q, options: options, answer: correct, explain: p.hasRings ? `${p.name} has a ring system (some are faint).` : `${p.name} has no rings.` };
      }
    }

    function genElementQuestion() {
      const e = pick(ELEMENTS, 1)[0];
      const types = ['symbol->name','name->symbol','atomic->name','group','state'];
      const t = pick(types,1)[0];

      if (t==='symbol->name') {
        const q = `Which element has the symbol <b>${e.symbol}</b>?`;
        const correct = e.name;
        const others = pick(ELEMENTS.filter(x=>x.name!==e.name), DIFF[state.difficulty].options-1).map(x=>x.name);
        return {q, options: shuffle([correct,...others]), answer: correct, explain: `${e.symbol} stands for ${e.name}.` };
      }
      if (t==='name->symbol') {
        const q = `What is the chemical symbol for <b>${e.name}</b>?`;
        const correct = e.symbol;
        const pool = pick(ELEMENTS.filter(x=>x.symbol!==e.symbol), DIFF[state.difficulty].options-1).map(x=>x.symbol);
        return {q, options: shuffle([correct,...pool]), answer: correct, explain: `${e.name} uses the symbol ${e.symbol}.` };
      }
      if (t==='atomic->name') {
        const q = `Which element is atomic number <b>${e.atomicNumber}</b>?`;
        const correct = e.name;
        const others = pick(ELEMENTS.filter(x=>x.name!==e.name), DIFF[state.difficulty].options-1).map(x=>x.name);
        return {q, options: shuffle([correct,...others]), answer: correct, explain: `${e.name} is element #${e.atomicNumber}.` };
      }
      if (t==='group') {
        const q = `${e.name} is which type of element?`;
        const correct = e.group;
        const groups = ['noble gas','halogen','alkali metal','alkaline earth metal','transition metal','post-transition metal','metalloid','nonmetal','lanthanide','actinide'];
        const options = shuffle([correct, ...pick(groups.filter(g=>g!==correct), DIFF[state.difficulty].options-1)]);
        return {q, options, answer: correct, explain: `${e.name} is classified as a ${e.group}.` };
      }
      if (t==='state') {
        const q = `What is the state of <b>${e.name}</b> at room temperature?`;
        const correct = e.state;
        const options = shuffle([correct, ...pick(['solid','liquid','gas'].filter(s=>s!==correct), DIFF[state.difficulty].options-1)]);
        return {q, options, answer: correct, explain: `At room temperature, ${e.name} is a ${e.state}.` };
      }
    }

    function genQuestion() {
      const pool = [];
      if (state.category==='planets') pool.push('planets');
      else if (state.category==='elements') pool.push('elements');
      else pool.push('planets','elements');
      const pickType = pick(pool,1)[0];
      return pickType==='planets' ? genPlanetQuestion() : genElementQuestion();
    }

    // Build a round (fixed number, or until lives out). We'll build 12 questions.
    function buildRound() {
      state.questions = Array.from({length: 12}, genQuestion);
    }

    // ======================
    // Game Loop
    // ======================
    const el = {
      screenStart: $('#screenStart'),
      screenGame: $('#screenGame'),
      screenEnd: $('#screenEnd'),
      qtext: $('#qtext'),
      answers: $('#answers'),
      timebar: $('#timebar'),
      time: $('#time'),
      score: $('#score'),
      streak: $('#streak'),
      metaQ: $('#metaQ'),
      explain: $('#explain'),
      btnFifty: $('#btnFifty'),
      hearts: document.querySelector('header .hearts'),
      summary: $('#summary'),
      review: $('#review'),
      toast: $('#toast')
    };

    function setHearts(n) {
      el.hearts.textContent = '❤️'.repeat(n) + '🖤'.repeat(3-n);
    }

    function startGame() {
      state.category = $('#category').value;
      state.difficulty = $('#difficulty').value;
      state.qIndex = 0; state.score = 0; state.streak = 0; state.lives = 3; state.usedFifty = false; state.history=[];
      setHearts(state.lives);
      buildRound();
      el.screenStart.classList.add('hidden');
      el.screenEnd.classList.add('hidden');
      el.screenGame.classList.remove('hidden');
      nextQuestion();
    }

    function nextQuestion() {
      if (state.lives<=0 || state.qIndex>=state.questions.length) return endGame();
      const q = state.questions[state.qIndex];
      el.qtext.innerHTML = q.q;
      el.metaQ.textContent = `Question ${state.qIndex+1} / ${state.questions.length}`;
      el.explain.textContent = '';
      el.answers.innerHTML = '';

      // Render answers
      q.options.forEach((opt, i)=>{
        const btn = document.createElement('button');
        btn.innerHTML = opt;
        btn.onclick = ()=> chooseAnswer(i);
        el.answers.appendChild(btn);
      });

      // Timer
      clearInterval(state.timerId);
      state.timeLeft = DIFF[state.difficulty].perQ;
      updateTimeUI();
      state.timerId = setInterval(()=>{
        state.timeLeft -= 1; updateTimeUI();
        if (state.timeLeft<=0) { clearInterval(state.timerId); outOfTime(); }
      }, 1000);

      // Enable 50/50 if available
      el.btnFifty.disabled = state.usedFifty;
      el.btnFifty.textContent = state.usedFifty ? '💡 50/50 (used)' : '💡 50/50';
    }

    function updateTimeUI() {
      el.time.textContent = state.timeLeft + 's';
      const pct = Math.max(0, Math.min(100, (state.timeLeft / DIFF[state.difficulty].perQ) * 100));
      el.timebar.style.width = pct + '%';
    }

    function chooseAnswer(index) {
      clearInterval(state.timerId);
      const q = state.questions[state.qIndex];
      const correctIndex = q.options.indexOf(q.answer);
      const buttons = $$('#answers button');

      let earned = 0; let correct = index===correctIndex;
      buttons.forEach((b,i)=>{
        b.disabled = true;
        if (i===correctIndex) b.classList.add('btn-good');
        if (i===index && !correct) b.classList.add('btn-bad');
      });

      if (correct) {
        const timeBonus = Math.ceil( (state.timeLeft/DIFF[state.difficulty].perQ) * 10 );
        const streakBonus = state.streak>=2 ? DIFF[state.difficulty].streakBonus : 0;
        earned = 10 + timeBonus + streakBonus;
        state.score += earned; state.streak += 1; sfx(true);
        el.explain.textContent = (q.explain||'Correct!') + ` (+${earned})`;
      } else {
        state.streak = 0; state.lives -= 1; setHearts(state.lives); sfx(false);
        el.explain.textContent = `Answer: ${q.answer}. ${(q.explain||'')}`.trim();
      }

      el.score.textContent = state.score;
      el.streak.textContent = state.streak;

      // Save history
      state.history.push({
        q: q.q, options: q.options.slice(), correctIndex, chosenIndex:index, explain:q.explain||'', points: earned
      });

      setTimeout(()=>{ state.qIndex += 1; nextQuestion(); }, 800);
    }

    function outOfTime() {
      const q = state.questions[state.qIndex];
      const correctIndex = q.options.indexOf(q.answer);
      const buttons = $$('#answers button');
      buttons.forEach((b,i)=>{ b.disabled = true; if (i===correctIndex) b.classList.add('btn-good'); });
      state.streak = 0; state.lives -= 1; setHearts(state.lives); sfx(false);
      el.explain.textContent = `Time's up! Answer: ${q.answer}. ${(q.explain||'')}`.trim();
      state.history.push({ q:q.q, options:q.options.slice(), correctIndex, chosenIndex:-1, explain:q.explain||'', points: 0 });
      setTimeout(()=>{ state.qIndex += 1; nextQuestion(); }, 900);
    }

    // 50/50 hint — remove half of wrong answers
    el.btnFifty.addEventListener('click', () => {
      if (state.usedFifty) return; state.usedFifty = true; el.btnFifty.disabled = true; el.btnFifty.textContent = '💡 50/50 (used)';
      const q = state.questions[state.qIndex];
      const correctIndex = q.options.indexOf(q.answer);
      const buttons = $$('#answers button');
      const wrongIndexes = buttons.map((_,i)=>i).filter(i=>i!==correctIndex);
      const toDisable = pick(wrongIndexes, Math.floor(wrongIndexes.length/2));
      toDisable.forEach(i=>{ buttons[i].disabled = true; buttons[i].style.opacity = .55; });
    });

    function endGame() {
      clearInterval(state.timerId);
      el.screenGame.classList.add('hidden');
      el.screenEnd.classList.remove('hidden');
      const correctCount = state.history.filter(h=>h.chosenIndex===h.correctIndex).length;
      const accuracy = Math.round((correctCount / state.history.length) * 100) || 0;
      el.summary.innerHTML = `Score: <b>${state.score}</b> · Correct: <b>${correctCount}/${state.history.length}</b> · Accuracy: <b>${accuracy}%</b>`;

      // High score (per mode)
      const key = `ccq_high_${state.category}_${state.difficulty}`;
      const best = Math.max(state.score, +(localStorage.getItem(key)||0));
      localStorage.setItem(key, best);
      el.summary.innerHTML += ` · Best (${state.category}/${state.difficulty}): <b>${best}</b>`;

      // Build review
      el.review.innerHTML = '';
      state.history.forEach((h,idx)=>{
        const div = document.createElement('div');
        div.className = 'review-item';
        const your = h.chosenIndex>=0 ? h.options[h.chosenIndex] : '<i>no answer</i>';
        div.innerHTML = `<div class="meta">Q${idx+1}</div><div>${h.q}</div>
          <div class="muted">Answer: <b>${h.options[h.correctIndex]}</b> · Your answer: ${your} · ${h.points?('+'+h.points+' pts'):'0 pts'}</div>
          <div class="muted">${h.explain||''}</div>`;
        el.review.appendChild(div);
      });

      fireConfetti();
    }

    // Share text copy
    $('#btnCopy').addEventListener('click', ()=>{
      const txt = `${GAME_TITLE} — I scored ${state.score} points on ${state.category.toUpperCase()} (${state.difficulty}). Try to beat me: ${location.href}`;
      navigator.clipboard.writeText(txt).then(()=> showToast('Copied to clipboard!')); 
    });

    function showToast(t) { el.toast.textContent = t; el.toast.classList.remove('hidden'); setTimeout(()=> el.toast.classList.add('hidden'), 1200); }

    // Buttons
    $('#btnStart').addEventListener('click', startGame);
    $('#btnPlayAgain').addEventListener('click', ()=> { el.screenEnd.classList.add('hidden'); el.screenStart.classList.remove('hidden'); });
    $('#btnHow').addEventListener('click', ()=>{
      alert('How to play:\n\n• Choose a category and difficulty, then Start.\n• Answer before the timer runs out.\n• Earn more points for speed and streaks.\n• You have 3 lives. Use 50/50 once per game.\n\nTip: Personalize this for a name/class or add your own questions!');
    });

    // Tiny sound effects (Web Audio beep)
    function sfx(ok) {
      try {
        const ctx = new (window.AudioContext||window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = ok? 'sine':'square'; o.frequency.value = ok? 740: 220; o.connect(g); g.connect(ctx.destination); g.gain.value = 0.06;
        o.start(); setTimeout(()=>{ o.stop(); ctx.close(); }, 110);
      } catch(e) { /* ignore */ }
    }

    // Confetti celebration
    function fireConfetti() {
      const root = document.getElementById('confetti');
      root.innerHTML = '';
      const colors = ['#6ee7ff','#a78bfa','#22c55e','#f59e0b','#ef4444','#eab308'];
      for (let i=0;i<120;i++) {
        const p = document.createElement('div');
        p.className = 'piece';
        p.style.background = colors[Math.floor(Math.random()*colors.length)];
        p.style.left = Math.random()*100 + '%';
        p.style.top = '-10px';
        p.style.transform = `rotate(${Math.random()*360}deg)`;
        root.appendChild(p);
        const duration = 600 + Math.random()*1200;
        const x = (Math.random()*2-1)*200; const y = 800 + Math.random()*400;
        p.animate([
          { transform: `translate(0,0) rotate(0deg)` },
          { transform: `translate(${x}px, ${y}px) rotate(${Math.random()*720}deg)` }
        ], { duration, easing: 'cubic-bezier(.2,.7,.2,1)', fill:'forwards' });
      }
      setTimeout(()=> root.innerHTML='', 2200);
    }
  </script>
</body>
</html>
